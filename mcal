#!/usr/bin/env bash

# Display and modify calendar events stored in local text files.

[[ $1 == "e" ]] && (cd $MCAL_DATA_DIR && nvim -c FZF) && exit

today="$(date +"%Y-%m-%d %a %H:%M")       === TODAY ==="
cal_events=$(cat $MCAL_DATA_DIR/* && printf "%s\n" "$today")

case $1 in
	"t") cat <<< $cal_events | sort | grep --color=auto $(date +%Y-%m-%d) ;;
	"m") cat <<< $cal_events | sort | grep --color=auto $(date +%Y-%m) ;;
	"n")
		echo -n "Date: "
		read date_entered
		date=$(date --date="$date_entered" +"%F %a")
		echo -n "Start time: "
		read start_time_entered
		[[ $start_time_entered ]] && start_time=$(date --date="$start_time_entered" +%R)
		echo -n "End time: "
		read end_time_entered
		[[ $end_time_entered ]] && end_time=$(date --date="$end_time_entered" +%R)
		calendar=$(gum filter --height=10 --placeholder="" --header="Calendar: " $(ls $MCAL_DATA_DIR))
		echo "Calendar: $calendar"
		echo -n "Tags: "
		read tags
		echo -n "Description: "
		read description
		echo "${date} ${start_time------}-${end_time------} ${calendar}:${tags} ${description}" | tee -a "$MCAL_DATA_DIR/$calendar"
		;;
	"") cat <<< $cal_events | sort ;;
	*) cat <<< $cal_events | sort | grep --color=auto "${*}" ;;
esac
