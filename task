#!/usr/bin/env bash

# Display and modify todo/task lists stored in local text files.

monthly_data="$TASK_DATA_DIR/monthly"
monthly_template="$TASK_DATA_DIR/monthly_tasks"
todo_data="$TASK_DATA_DIR/todo"

case $1 in
	"e")
		(cd $task_dir && nvim -c FZF)
		;;
	"m")
		if [[ -n "$2" ]]; then
			month=$(date +%Y-%m)
			sed -i "/$month.*$2/ s/\[ \]/[X]/" $monthly_data
			sed -i "/$month.*$2/ s/xx/$(date +%d)/" $monthly_data
		else
			grep $(date +%Y-%m) $monthly_data
		fi
		;;
	"mi")
		while IFS= read -r line; do
			echo "$(date +'%Y-%m-xx') [ ] $line" >> $monthly_data
		done < $monthly_template
		;;
	"c")
		grep "^x" $todo_data
		;;
	*)
		if [[ -n "$1" ]]; then
			sed -i "/$1/ s/^/x $(date +%Y-%m-%d) /" $todo_data
		else
			grep -v "^x" $todo_data
		fi
		;;
esac
